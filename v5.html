<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Pharma Hub | د. داود تاج الدين | GMP-Compliant System</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --main-blue: #0f172a; --pharma-green: #10b981; --lab-gray: #f8fafc; --border: #e2e8f0; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--lab-gray); margin: 0; display: flex; height: 100vh; color: #1e293b; }
        
        /* Sidebar Navigation */
        aside { width: 280px; background: white; border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .logo-section { padding: 30px; text-align: center; border-bottom: 2px solid var(--pharma-green); background: var(--main-blue); color: white; }
        .nav-group { padding: 15px; }
        .nav-header { font-size: 11px; font-weight: bold; color: #94a3b8; text-transform: uppercase; padding: 10px 5px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; cursor: pointer; color: #475569; transition: 0.3s; font-size: 14px; }
        .nav-item:hover, .nav-item.active { background: #f1f5f9; color: var(--main-blue); font-weight: 600; }

        /* Main Body */
        main { flex: 1; overflow-y: auto; }
        header { background: white; height: 70px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; position: sticky; top: 0; z-index: 50; }
        .container { padding: 30px; max-width: 1400px; margin: 0 auto; }

        /* Grid System */
        .card { background: white; border-radius: 12px; border: 1px solid var(--border); padding: 25px; margin-bottom: 25px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 20px; }
        
        /* Specialized Controls */
        label { display: block; font-size: 12px; font-weight: 700; color: #64748b; margin-bottom: 8px; }
        select, input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; outline: none; background: #fff; }
        .btn-pharma { background: var(--main-blue); color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; }

        /* Status Colors */
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; }
        .status-pass { background: #dcfce7; color: #166534; }
        .status-fail { background: #fee2e2; color: #991b1b; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: right; font-size: 12px; color: #64748b; padding: 15px; background: #f8fafc; border-bottom: 2px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid var(--border); font-size: 13px; }
    </style>
</head>
<body>

    <aside>
        <div class="logo-section">
            <i data-lucide="microscope" style="width:40px; height:40px; margin-bottom:10px;"></i>
            <div style="font-size: 18px;">PHARMA HUB</div>
            <div style="font-size: 10px; opacity: 0.8;">Quality Assurance Intelligence</div>
        </div>
        <nav>
            <div class="nav-header">سير العملية والرقابة</div>
            <div class="nav-item active"><i data-lucide="gauge"></i> لوحة المتابعة</div>
            <div class="nav-item"><i data-lucide="layers"></i> تحليل المواد الخام (API/Excipients)</div>
            <div class="nav-item"><i data-lucide="flask-conical"></i> الاختبارات المايكروبيولوجية</div>
            <div class="nav-item"><i data-lucide="activity"></i> اختبارات الـ In-Process</div>
            <div class="nav-item"><i data-lucide="package-check"></i> فحص المنتج النهائي</div>
        </nav>
    </aside>

    <main>
        <header>
            <div><i data-lucide="calendar" style="width:16px; vertical-align:middle;"></i> <span id="currentDate"></span></div>
            <div style="text-align: left;">
                <div style="font-weight: 800;">د. داود تاج الدين أحمد</div>
                <div style="font-size: 11px; color: var(--pharma-green);">إشراف الجودة والرقابة الدوائية</div>
            </div>
        </header>

        <div class="container">
            <div class="card">
                <h3 style="margin-top:0; border-right: 4px solid var(--pharma-green); padding-right: 15px;">نظام إدخال البيانات الفنية (Technical Entry)</h3>
                <div class="form-grid">
                    <div>
                        <label>نوع المادة / المرحلة</label>
                        <select id="stageType" onchange="updateProductList()">
                            <option value="Raw">مادة خام (API/Excipients)</option>
                            <option value="InProcess">أثناء التصنيع (In-Process)</option>
                            <option value="Finished">المنتج النهائي (Finished Product)</option>
                            <option value="Micro">تحليل مايكروبيولوجي (Micro)</option>
                        </select>
                    </div>
                    <div>
                        <label>المستحضر / المادة</label>
                        <select id="productSelect" onchange="updateTests()"></select>
                    </div>
                    <div>
                        <label>رقم التشغيلة / الـ Batch</label>
                        <input type="text" id="batchNo" placeholder="Batch No.">
                    </div>
                    <div>
                        <label>الدستور المرجعي</label>
                        <select id="refSpec">
                            <option value="BP 2025">BP 2025</option>
                            <option value="USP 43">USP 43-NF 38</option>
                            <option value="In-House">Internal Specifications</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div>
                        <label>نوع الاختبار الفني</label>
                        <select id="testSelect"></select>
                    </div>
                    <div>
                        <label>النتيجة المخبرية</label>
                        <input type="number" id="testResult" step="0.001" placeholder="أدخل الرقم">
                    </div>
                    <div>
                        <label>اسم المحلل</label>
                        <input type="text" id="analyst" placeholder="Name of Analyst">
                    </div>
                    <div>
                        <label>حفظ التوثيق</label>
                        <button class="btn-pharma" onclick="submitTest()">اعتماد وحفظ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>سجل الرقابة الشامل (Compliance Audit Log)</h3>
                <table id="logTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>المادة / التشغيلة</th>
                            <th>الاختبار</th>
                            <th>النتيجة</th>
                            <th>الحالة</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="logBody"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' });

        const technicalDB = {
            "Raw": {
                "Paracetamol (API)": [{t:"Assay", min:99.0, max:101.0}, {t:"LOD", min:0, max:0.5}, {t:"Iron", min:0, max:0.001}],
                "Starch (Excipient)": [{t:"Moisture", min:0, max:14.0}, {t:"pH", min:5.0, max:7.0}]
            },
            "InProcess": {
                "Paracetamol Granules": [{t:"Bulk Density", min:0.4, max:0.6}, {t:"Moisture", min:1.5, max:2.5}],
                "Tablets Pressing": [{t:"Average Weight", min:475, max:525}, {t:"Hardness", min:60, max:120}, {t:"Thickness", min:3.8, max:4.2}]
            },
            "Finished": {
                "Paracetamol 500mg": [{t:"Assay", min:95, max:105}, {t:"Dissolution", min:80, max:100}, {t:"Friability", min:0, max:1.0}]
            },
            "Micro": {
                "Finished Product": [{t:"TAMC (CFU/g)", min:0, max:1000}, {t:"TYMC (CFU/g)", min:0, max:100}, {t:"E.coli", min:0, max:0}]
            }
        };

        function updateProductList() {
            const stage = document.getElementById('stageType').value;
            const pSel = document.getElementById('productSelect');
            pSel.innerHTML = '';
            Object.keys(technicalDB[stage]).forEach(p => pSel.add(new Option(p, p)));
            updateTests();
        }

        function updateTests() {
            const stage = document.getElementById('stageType').value;
            const p = document.getElementById('productSelect').value;
            const tSel = document.getElementById('testSelect');
            tSel.innerHTML = '';
            technicalDB[stage][p].forEach((test, i) => {
                tSel.add(new Option(`${test.t} (${test.min}-${test.max})`, i));
            });
        }

        function submitTest() {
            const stage = document.getElementById('stageType').value;
            const p = document.getElementById('productSelect').value;
            const tIdx = document.getElementById('testSelect').value;
            const res = parseFloat(document.getElementById('testResult').value);
            const batch = document.getElementById('batchNo').value;
            
            if(isNaN(res) || !batch) return alert("يرجى إكمال بيانات التحليل");

            const spec = technicalDB[stage][p][tIdx];
            const isPass = res >= spec.min && res <= spec.max;

            const row = `<tr>
                <td><small>${new Date().toLocaleString()}</small></td>
                <td><b>${p}</b><br><small>Batch: ${batch}</small></td>
                <td>${spec.t}</td>
                <td>${res}</td>
                <td><span class="badge ${isPass?'status-pass':'status-fail'}">${isPass?'Complies':'OOS'}</span></td>
                <td><button onclick="this.parentElement.parentElement.remove()" style="border:none; color:red; cursor:pointer;">حذف</button></td>
            </tr>`;
            document.getElementById('logBody').innerHTML = row + document.getElementById('logBody').innerHTML;
        }

        updateProductList();
    </script>
</body>
</html>