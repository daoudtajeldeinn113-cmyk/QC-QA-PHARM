<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Pharma LIMS Pro v8.0 | Dr. Daoud</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --primary: #1e293b; --accent: #0284c7; --bg: #f8fafc; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; }
        aside { width: 280px; background: var(--primary); color: white; height: 100vh; padding: 20px; position: fixed; }
        main { margin-right: 280px; flex: 1; padding: 30px; }
        .card { background: var(--white); border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; margin-bottom: 20px; }
        .section-title { font-size: 18px; font-weight: bold; color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .field { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: 700; color: #64748b; margin-bottom: 5px; }
        input, select, textarea { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; width: 100%; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { padding: 12px 20px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-save { background: var(--accent); color: white; flex: 2; }
        .btn-print { background: #64748b; color: white; flex: 1; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th { background: #f1f5f9; padding: 12px; text-align: right; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .coa-print-area { display: none; }
        @media print {
            body * { visibility: hidden; }
            .coa-print-area, .coa-print-area * { visibility: visible; }
            .coa-print-area { display: block; position: absolute; left: 0; top: 0; width: 100%; padding: 40px; }
        }
    </style>
</head>
<body>

<aside>
    <div style="text-align: center; margin-bottom: 40px;">
        <i data-lucide="shield-check" style="width: 50px; height: 50px; color: var(--accent);"></i>
        <h3>نظام الجودة المعتمد</h3>
        <p style="font-size: 12px; color: #94a3b8;">GMP/GLP Compliant v8.0</p>
    </div>
    <div style="font-size: 14px; line-height: 2;">
        <div><i data-lucide="user"></i> المحلل: د. داود</div>
        <div><i data-lucide="calendar"></i> التاريخ: <span id="currentDate"></span></div>
    </div>
</aside>

<main>
    <div class="card">
        <div class="section-title"><i data-lucide="factory"></i> بيانات الشركة والمصنع</div>
        <div class="grid">
            <div class="field"><label>اسم المصنع/المورد</label><input type="text" id="mfgName" placeholder="Manufacturer Name"></div>
            <div class="field"><label>العنوان</label><input type="text" id="mfgAddress" placeholder="Address"></div>
            <div class="field"><label>نوع التحليل</label>
                <select id="sampleType" onchange="toggleFields()">
                    <option value="RM">Raw Material (المواد الخام)</option>
                    <option value="FP">Finished Product (المنتج النهائي)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-title"><i data-lucide="package"></i> معلومات المنتج (Product Specs)</div>
        <div class="grid">
            <div class="field"><label>اسم المادة/المنتج</label><input type="text" id="prodName"></div>
            <div id="fpOnly" style="display:none; grid-column: span 2;">
                <div class="grid" style="margin-bottom:0;">
                    <div class="field"><label>الشكل الصيدلاني</label><input type="text" id="dosageForm" placeholder="Tablet, Syrup, etc."></div>
                    <div class="field"><label>التركيز (Strength)</label><input type="text" id="strength"></div>
                </div>
            </div>
            <div class="field"><label>رقم التشغيلة</label><input type="text" id="batchNo"></div>
            <div class="field"><label>تاريخ الإنتاج</label><input type="date" id="mfgDate"></div>
            <div class="field"><label>تاريخ الانتهاء</label><input type="date" id="expDate"></div>
            <div class="field"><label>المواصفة المتبعة</label>
                <select id="specStandard">
                    <option value="BP 2025">British Pharmacopoeia (BP)</option>
                    <option value="USP 2024">United States Pharmacopoeia (USP)</option>
                    <option value="In-House">Internal Specification</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="section-title"><i data-lucide="test-tube-2"></i> الاختبارات والنتائج (Evidence-Based)</div>
        <div id="testContainer">
            </div>
        <div class="btn-group">
            <button class="btn-save" onclick="generateCOA()"><i data-lucide="file-check"></i> اعتماد النتائج وإصدار التقرير</button>
            <button class="btn-print" onclick="window.print()"><i data-lucide="printer"></i> طباعة COA</button>
        </div>
    </div>
</main>

<div id="printArea" class="coa-print-area">
    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px;">
        <h2 id="outCompany">CERTIFICATE OF ANALYSIS</h2>
        <p id="outAddress"></p>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div>
            <p><strong>Product Name:</strong> <span id="outProd"></span></p>
            <p><strong>Batch No:</strong> <span id="outBatch"></span></p>
            <p><strong>Mfg Date:</strong> <span id="outMfg"></span></p>
            <p><strong>Exp Date:</strong> <span id="outExp"></span></p>
        </div>
        <div style="text-align: right;">
            <p><strong>Specification:</strong> <span id="outSpec"></span></p>
            <p><strong>Date of Analysis:</strong> <span id="outAnalDate"></span></p>
        </div>
    </div>
    <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="background: #eee;">
                <th>Test Parameter</th>
                <th>Specification</th>
                <th>Result</th>
                <th>Conclusion</th>
            </tr>
        </thead>
        <tbody id="outTableBody"></tbody>
    </table>
    <div style="margin-top: 50px; display: grid; grid-template-columns: 1fr 1fr 1fr; text-align: center;">
        <div><p>Analyst</p><br><p><strong>Dr. Daoud Tajeldeinn</strong></p></div>
        <div><p>QC Manager</p><br><p>________________</p></div>
        <div><p>QA Approval</p><br><p>________________</p></div>
    </div>
</div>

<script>
    lucide.createIcons();
    document.getElementById('currentDate').innerText = new Date().toLocaleDateString();

    const rawMaterialTests = [
        {t: "Description", s: "White crystalline powder"},
        {t: "Identification (FTIR/IR)", s: "Conforms to Reference Spectrum"},
        {t: "Melting Point", s: "As per Monograph"},
        {t: "Potancy / Assay", s: "99.0% - 101.0%"},
        {t: "Related Substances (HPLC)", s: "Total Impurities < 0.5%"},
        {t: "pH (if applicable)", s: "As per Monograph"},
        {t: "TAMC (Micro)", s: "Max 1000 CFU/g"},
        {t: "TYMC (Micro)", s: "Max 100 CFU/g"},
        {t: "E. Coli", s: "Absent"}
    ];

    const finishedProductTests = [
        {t: "Description", s: "Round Biconvex Tablets"},
        {t: "Identification", s: "Positive for Active Ingredient"},
        {t: "Average Weight", s: "Target weight ± 5%"},
        {t: "Hardness (N)", s: "80N - 150N"},
        {t: "Thickness (mm)", s: "Standard ± 0.2mm"},
        {t: "Friability (%)", s: "NMT 1.0%"},
        {t: "Disintegration", s: "NMT 15 Minutes"},
        {t: "Dissolution Test", s: "Min 75% in 45 min"},
        {t: "Assay / Potancy", s: "95.0% - 105.0%"},
        {t: "Microbiological Quality", s: "Comply with BP/USP"}
    ];

    function toggleFields() {
        const type = document.getElementById('sampleType').value;
        const fpOnly = document.getElementById('fpOnly');
        const container = document.getElementById('testContainer');
        
        fpOnly.style.display = (type === 'FP') ? 'block' : 'none';
        
        const tests = (type === 'FP') ? finishedProductTests : rawMaterialTests;
        container.innerHTML = tests.map((test, i) => `
            <div class="grid" style="grid-template-columns: 2fr 2fr 1fr; align-items: center;">
                <div><label>الاختبار</label><input type="text" id="tName${i}" value="${test.t}"></div>
                <div><label>المواصفة (BP/USP)</label><input type="text" id="tSpec${i}" value="${test.s}"></div>
                <div><label>النتيجة</label><input type="text" id="tRes${i}" placeholder="Enter Result"></div>
            </div>
        `).join('');
    }

    function generateCOA() {
        // نقل البيانات لمنطقة الطباعة
        document.getElementById('outCompany').innerText = document.getElementById('mfgName').value || "CERTIFICATE OF ANALYSIS";
        document.getElementById('outAddress').innerText = document.getElementById('mfgAddress').value;
        document.getElementById('outProd').innerText = document.getElementById('prodName').value + (document.getElementById('strength').value ? ' ' + document.getElementById('strength').value : '');
        document.getElementById('outBatch').innerText = document.getElementById('batchNo').value;
        document.getElementById('outMfg').innerText = document.getElementById('mfgDate').value;
        document.getElementById('outExp').innerText = document.getElementById('expDate').value;
        document.getElementById('outSpec').innerText = document.getElementById('specStandard').value;
        document.getElementById('outAnalDate').innerText = new Date().toLocaleDateString();

        const type = document.getElementById('sampleType').value;
        const count = (type === 'FP') ? finishedProductTests.length : rawMaterialTests.length;
        let rows = "";
        for(let i=0; i<count; i++) {
            rows += `<tr>
                <td>${document.getElementById('tName'+i).value}</td>
                <td>${document.getElementById('tSpec'+i).value}</td>
                <td>${document.getElementById('tRes'+i).value}</td>
                <td>COMPLIES</td>
            </tr>`;
        }
        document.getElementById('outTableBody').innerHTML = rows;
        alert("تم تجهيز شهادة التحليل. يمكنك الآن الضغط على طباعة.");
    }

    window.onload = toggleFields;
</script>
</body>
</html>