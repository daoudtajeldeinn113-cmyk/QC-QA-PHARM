<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pharma LIMS v10.1 | Official COA System</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --primary: #1e293b; --accent: #0284c7; --border: #cbd5e1; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f1f5f9; display: flex; }
        aside { width: 300px; background: var(--primary); color: white; height: 100vh; padding: 20px; position: fixed; }
        main { margin-left: 300px; padding: 30px; flex: 1; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        label { font-size: 11px; font-weight: bold; color: #64748b; text-transform: uppercase; }
        input, select { width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; }
        
        /* Print Header Style */
        #coa-print { display: none; width: 210mm; background: white; padding: 30px; margin: auto; color: black; border: 2px solid #000; }
        .coa-header { display: flex; justify-content: space-between; border-bottom: 3px solid #000; padding-bottom: 10px; }
        .coa-title { text-align: center; font-weight: bold; font-size: 20px; margin: 15px 0; border: 1px solid #000; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        table, th, td { border: 1px solid black; padding: 6px; text-align: left; }
        .footer { margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr 1fr; text-align: center; font-size: 11px; }

        @media print {
            aside, main { display: none; }
            #coa-print { display: block; }
        }
    </style>
</head>
<body>

<aside>
    <h3><i data-lucide="shield-check"></i> Quality Control</h3>
    <label>Sample Category</label>
    <select id="sampleType" onchange="toggleFields()">
        <option value="FP">Finished Product (FP)</option>
        <option value="RM">Raw Material (RM)</option>
    </select>
    <br><br>
    <label>Analyst Name</label>
    <input type="text" id="analyst" value="Dr. Daoud Tajeldeinn">
</aside>

<main>
    <div class="card">
        <h3>Product Header Information</h3>
        <div class="grid">
            <div><label>Product Name</label><input type="text" id="pName"></div>
            <div><label>Manufacturer</label><input type="text" id="mfg"></div>
            <div><label>A.R. Number</label><input type="text" id="arNo"></div>
        </div>
        <div class="grid">
            <div><label>Batch No</label><input type="text" id="batch"></div>
            <div><label>Mfg Date</label><input type="text" id="mfgDate" placeholder="MM.YYYY"></div>
            <div><label>Exp Date</label><input type="text" id="expDate" placeholder="MM.YYYY"></div>
        </div>
        
        <div class="grid" id="fp-only">
            <div><label>Strength</label><input type="text" id="strength"></div>
            <div><label>Pack Size</label><input type="text" id="packSize"></div>
            <div><label>Generic Name</label><input type="text" id="generic"></div>
        </div>
        <div class="grid" id="rm-only" style="display:none;">
            <div><label>Date of Receipt</label><input type="date" id="recDate"></div>
            <div><label>Date of Re-Analysis</label><input type="date" id="reAnalDate"></div>
            <div><label>Sample Qty</label><input type="text" id="qty" value="20gm"></div>
        </div>
    </div>

    <div class="card">
        <h3>Analysis Results</h3>
        <div id="testArea"></div>
        <button onclick="window.print()" style="margin-top:20px; background:var(--accent); color:white; padding:10px 20px; border:none; cursor:pointer;">Generate & Print COA</button>
    </div>
</main>

<div id="coa-print">
    <div class="coa-header">
        <div>
            <h2 style="margin:0;">SCI Pharmaceutical Industry</h2>
            <p style="margin:0;">Industrial Zone, Khartoum, Sudan</p>
        </div>
        <div style="text-align:right;">
            <strong>A.R. NO: <span id="outAR"></span></strong>
        </div>
    </div>

    <div class="coa-title" id="outTitle">CERTIFICATE OF ANALYSIS</div>

    <table id="infoTable"></table>

    <table style="margin-top:20px;">
        <thead>
            <tr style="background:#eee;">
                <th>Test Parameter</th>
                <th>Specification</th>
                <th>Result</th>
                <th>Compliance</th>
            </tr>
        </thead>
        <tbody id="outTests"></tbody>
    </table>

    <div class="footer">
        <div><hr><strong>Analyst Signature</strong><br><span id="outAnalyst"></span></div>
        <div><hr><strong>QC Manager</strong><br>Sign & Date</div>
        <div><hr><strong>QA Release</strong><br>Authorized Signature</div>
    </div>
</div>

<script>
    lucide.createIcons();

    const specs = {
        FP: [
            {t: "Description", s: "White round tablets", r: "Comply"},
            {t: "Uniformity of Weight", s: "Target ± 5%", r: ""},
            {t: "Disintegration", s: "NMT 15 min", r: ""},
            {t: "Assay", s: "95% - 105%", r: ""}
        ],
        RM: [
            {t: "Appearance", s: "Crystalline Powder", r: "Comply"},
            {t: "Melting Point", s: "168°C - 172°C", r: ""},
            {t: "Loss on Drying", s: "NMT 0.5%", r: ""},
            {t: "Assay (Purity)", s: "99% - 101%", r: ""}
        ]
    };

    function toggleFields() {
        const type = document.getElementById('sampleType').value;
        document.getElementById('fp-only').style.display = (type === 'FP') ? 'grid' : 'none';
        document.getElementById('rm-only').style.display = (type === 'RM') ? 'grid' : 'none';
        loadTests();
    }

    function loadTests() {
        const type = document.getElementById('sampleType').value;
        document.getElementById('testArea').innerHTML = specs[type].map((test, i) => `
            <div class="grid">
                <input type="text" id="tn${i}" value="${test.t}">
                <input type="text" id="ts${i}" value="${test.s}">
                <input type="text" id="tr${i}" value="${test.r}" placeholder="Result">
            </div>
        `).join('');
    }

    window.onbeforeprint = function() {
        const type = document.getElementById('sampleType').value;
        document.getElementById('outTitle').innerText = (type === 'FP') ? "CERTIFICATE OF ANALYSIS" : "CERTIFICATE OF ANALYSIS (RE-ANALYSIS)";
        document.getElementById('outAR').innerText = document.getElementById('arNo').value;
        document.getElementById('outAnalyst').innerText = document.getElementById('analyst').value;

        let info = `
            <tr><td><strong>Product:</strong> ${document.getElementById('pName').value}</td><td><strong>Batch:</strong> ${document.getElementById('batch').value}</td></tr>
            <tr><td><strong>Manufacturer:</strong> ${document.getElementById('mfg').value}</td><td><strong>Mfg Date:</strong> ${document.getElementById('mfgDate').value}</td></tr>
        `;
        
        if(type === 'FP') {
            info += `<tr><td><strong>Strength:</strong> ${document.getElementById('strength').value}</td><td><strong>Exp Date:</strong> ${document.getElementById('expDate').value}</td></tr>`;
        } else {
            info += `<tr><td><strong>Receipt Date:</strong> ${document.getElementById('recDate').value}</td><td><strong>Re-Analysis Date:</strong> ${document.getElementById('reAnalDate').value}</td></tr>`;
        }
        document.getElementById('infoTable').innerHTML = info;

        let rows = "";
        specs[type].forEach((_, i) => {
            rows += `<tr><td>${document.getElementById('tn'+i).value}</td><td>${document.getElementById('ts'+i).value}</td><td>${document.getElementById('tr'+i).value}</td><td>Yes</td></tr>`;
        });
        document.getElementById('outTests').innerHTML = rows;
    };

    window.onload = loadTests;
</script>
</body>
</html>